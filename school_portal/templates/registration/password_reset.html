{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}إعادة تعيين كلمة المرور - تعلمي في يدي{% endblock %}

{% block content %}
<div class="container py-5" dir="rtl" lang="ar">
    <div class="row justify-content-center">
        <div class="col-xl-5 col-lg-6 col-md-8 col-sm-10">
            <div id="reset-card" class="card shadow-lg rounded-4 overflow-hidden"
                 style="opacity:0; transform: translateY(30px);">

                <!-- Header -->
                <div class="card-header text-center p-4" style="background: var(--gradient-primary); color: var(--color-on-primary);">
                    <h3 class="fw-bold mb-0" style="opacity:0; transform: translateY(-20px);">إعادة تعيين كلمة المرور</h3>
                    <p class="small mt-1 opacity-75" style="opacity:0; transform: translateY(-20px);">
                        أدخل بريدك الإلكتروني وسنرسل لك رابطًا لإعادة التعيين
                    </p>
                </div>

                <!-- Body -->
                <div class="card-body p-4">

                    <!-- Instruction above the form -->
                    <p class="text-center mb-4" style="opacity:0; transform: translateY(10px);" id="instruction">
                        الرجاء إدخال البريد الإلكتروني الخاص بك لاستعادة كلمة المرور
                    </p>

                    {% if form.errors %}
                    <div class="alert alert-danger rounded-3 shadow-sm animate__animated animate__shakeX" id="error-msg">
                        ⚠️ تأكد من إدخال البريد الإلكتروني بشكل صحيح.
                    </div>
                    {% endif %}

                    <form method="post" id="reset-form" class="mt-3">
                        {% csrf_token %}
                        <div class="mb-3 reset-field" style="opacity:0; transform: translateX(-20px);">
                            {{ form.email|add_class:"form-control form-control-lg shadow-sm rounded-3" }}
                        </div>
                        <button type="submit" id="reset-btn" class="btn w-100 btn-lg rounded-pill shadow-lg mt-3">
                            إرسال الرابط
                        </button>
                    </form>

                    <div class="mt-4 text-center small" style="opacity:0; transform: translateY(10px);">
                        <a href="{% url 'login' %}" class="text-decoration-none">العودة لتسجيل الدخول</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Animate.css CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
:root {
    /* Light theme colors */
    --color-bg: #f9fafe;
    --color-text: #111827;
    --color-on-primary: #ffffff;
    --gradient-primary: linear-gradient(135deg, #4facfe, #00f2fe);
    --shadow-color: rgba(0,123,255,0.2);
    --input-focus: rgba(79,172,254,0.5);
}

[data-theme="dark"] {
    --color-bg: #1f1f2e;
    --color-text: #f5f5f5;
    --gradient-primary: linear-gradient(135deg, #1e3c72, #2a5298);
    --shadow-color: rgba(0,180,216,0.3);
    --input-focus: rgba(0,242,254,0.4);
}

/* Card style */
.card {
    background-color: var(--color-bg);
    color: var(--color-text);
    transition: all 0.4s ease-in-out;
    box-shadow: 0 15px 50px var(--shadow-color);
}
.card:hover {
    transform: translateY(-3px);
}

/* Header */
.card-header {
    font-family: 'Segoe UI', sans-serif;
}

/* Input focus */
.form-control:focus {
    border-color: var(--gradient-primary);
    box-shadow: 0 0 12px var(--input-focus);
    transition: all 0.3s ease-in-out;
}

/* Button */
#reset-btn {
    background: var(--gradient-primary);
    color: var(--color-on-primary);
    border: none;
    transition: all 0.3s ease-in-out;
}
#reset-btn:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 0 25px var(--input-focus), 0 6px 20px var(--input-focus);
}
#reset-btn:active {
    transform: scale(0.97);
    box-shadow: 0 0 25px var(--input-focus) inset;
}

/* Error shake */
.shake {
    animation: shake 0.5s;
}
@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}

/* Small screens */
@media (max-width: 576px) {
    .card { margin-top: 2rem !important; }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const card = document.getElementById('reset-card');
    const header = card.querySelector('h3');
    const subtitle = card.querySelector('p');
    const fields = document.querySelectorAll('.reset-field');
    const link = card.querySelector('div.text-center');
    const instruction = document.getElementById('instruction');

    // Animate card
    setTimeout(() => { card.style.opacity = 1; card.style.transform = 'translateY(0)'; }, 100);

    // Animate header
    setTimeout(() => { header.style.opacity = 1; header.style.transform = 'translateY(0)'; }, 400);
    setTimeout(() => { subtitle.style.opacity = 1; subtitle.style.transform = 'translateY(0)'; }, 600);

    // Animate instruction
    setTimeout(() => { instruction.style.opacity = 1; instruction.style.transform = 'translateY(0)'; }, 700);

    // Animate input field
    fields.forEach((field, index) => {
        setTimeout(() => {
            field.style.opacity = 1;
            field.style.transform = 'translateX(0)';
        }, 800 + index*300);
    });

    // Animate link
    setTimeout(() => {
        link.style.opacity = 1;
        link.style.transform = 'translateY(0)';
    }, 1200);

    // Shake on error
    const error = document.getElementById('error-msg');
    if(error){
        error.classList.add('shake');
    }
});
</script>
{% endblock %}
