from django.shortcuts import render, get_object_or_404
from django.views.generic import TemplateView, ListView, DetailView
from django.contrib.auth.mixins import LoginRequiredMixin
from django.contrib import messages
from .models import Lesson, TimetableSlot, Subject, Grade, Exam
from django.http import Http404


# ================== الصفحة الرئيسية ==================
class IndexView(TemplateView):
    template_name = 'academics/index.html'


# ================== الصفحات العامة (لا تحتاج تسجيل) ==================
class SubjectListView(ListView):
    """عرض المواد لجميع المستخدمين"""
    model = Subject
    template_name = 'academics/subjects.html'
    context_object_name = 'subjects'
    paginate_by = 25


class TimetableView(ListView):
    """عرض الجدول الدراسي"""
    model = TimetableSlot
    template_name = 'academics/timetable.html'
    context_object_name = 'slots'


# ================== الصفحات التي تحتاج تسجيل دخول ==================
class LessonDetailView(LoginRequiredMixin, DetailView):
    """عرض تفاصيل الدرس مع التحقق من روابط الفيديو"""
    model = Lesson
    template_name = 'academics/lesson_detail.html'
    context_object_name = 'lesson'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        lesson = self.get_object()
        
        # Collect all video URLs (you might have multiple videos per lesson)
        video_urls = []
        if lesson.video_url:
            video_urls.append(lesson.video_url)
            
        # Validate and clean video URLs
        if video_urls:
            cleaned_urls, errors = validate_youtube_urls(video_urls)
            
            # Add cleaned URLs to context
            context['video_urls'] = cleaned_urls
            
            # If there were any errors, add them as messages
            for url, error in errors.items():
                messages.warning(self.request, f'Invalid video URL ({url}): {error}')
        
        return context


class ExamListView(ListView):
    """عرض قائمة الامتحانات"""
    model = Exam
    template_name = 'academics/exams.html'
    context_object_name = 'exams'


class GradeListView(LoginRequiredMixin, ListView):
    """عرض العلامات"""
    model = Grade
    template_name = 'academics/grades.html'
    context_object_name = 'grades'


class LessonDetailView(LoginRequiredMixin, DetailView):
    """عرض تفاصيل الدرس"""
    model = Lesson
    template_name = 'academics/lesson_detail.html'
    pk_url_kwarg = 'lesson_id'
    context_object_name = 'lesson'


# ================== عرض المواد الدراسية لكل صف ==================
def subjects_view(request):
    grades = [
        {"number": 1, "name": "الصف الأول", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية", "التربية الاجتماعية",]},
        {"number": 2, "name": "الصف الثاني", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية", "التربية الاجتماعية"]},
        {"number": 3, "name": "الصف الثالث", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية", "التربية الاجتماعية",]},
        {"number": 4, "name": "الصف الرابع", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية", "الدراسات الاجتماعية","التربية الوطنية والمدنية", "الرياضة"]},
        {"number": 5, "name": "الصف الخامس", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية", "الدراسات الاجتماعية","التربية الوطنية والمدنية", "الرياضة"]},
        {"number": 6, "name": "الصف السادس", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية", "الدراسات الاجتماعية","التربية الوطنية والمدنية", "التربية الفنية", "الرياضة"]},
        {"number": 7, "name": "الصف السابع", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية","الدراسات الاجتماعية","المهارات الرقمية","الثقافة المالية"]},
        {"number": 8, "name": "الصف الثامن", "subjects": ["العربية لغتي", "الرياضيات", "اللغة الإنجليزية","العلوم", "التربية الإسلامية","الدراسات الاجتماعية", "المهارات الرقمية","الثقافة المالية"]},
        {"number": 9, "name": "الصف التاسع", "subjects": ["العربية لغتي", "اللغة الإنجليزية" ,"الرياضيات","الفيزياء", "الكيمياء", "العلوم الحياتية","علوم الأرض والبيئة","التربية الإسلامية", "التاريخ", "الجغرافيا","التربية الوطنية والمدنية","الثقافة المالية" ,"المهارات الرقمية"]},
        {"number": 10, "name": "الصف العاشر", "subjects": ["العربية لغتي", "اللغة الإنجليزية" ,"الرياضيات", "الفيزياء", "الكيمياء", "العلوم الحياتية","علوم الأرض والبيئة","التربية الإسلامية", "التاريخ", "الجغرافيا","التربية الوطنية والمدنية","الثقافة المالية","المهارات الرقمية"]},
        {"number": 11, "name": "الصف الأول ثانوي", "subjects": ["العربية لغتي", "اللغة الإنجليزية", "الرياضيات","الفيزياء", "الكيمياء", "العلوم الحياتية", "علوم الأرض والبيئة","المهارات الرقمية", "التربية الإسلامية","تاريخ الأردن","الثقافة المالية"]},
        {"number": 12, "name": "الصف الثاني ثانوي (التوجيهي)", "subjects": ["العربية لغتي", "اللغة الإنجليزية", "الرياضيات","الفيزياء", "الكيمياء", "العلوم الحياتية", "علوم الأرض والبيئة","الثقافة الإسلامية", "تاريخ الأردن",]},
    ]

    return render(request, "academics/subjects.html", {"grades": grades})




def subject_detail_view(request, grade_number, subject_name):
    if grade_number != 10:
        raise Http404("المواد متاحة فقط للصف العاشر")

    # المنهاج الأردني للصف العاشر فقط
    curriculum = {
        "الرياضيات": [
            {"unit": "الوحدة الأولى: الأسس والمعادلات", "lessons": [
                "حل نظام مكون من معادلة خطبية و تربيعية",
                "حل نظام مكون من معادلتين تربيعيتين",
                "تبسيط المقادير الاسية",
                "حل المعادلات الاسية"
            ]},
            {"unit": "الوحدة الثانية: الدائرة", "lessons": [
                "أوتار الدائرة وأقطارها ومماساتها",
                "الأقواس والقطاعات الدائرية",
                "الزاوية في الدائرة",
                "معادلة الدائرة",
                "الدوائر المتماسة"
            ]},
            {"unit": "الوحدة الثالثة: حساب المثلثات", "lessons": [
                "النسب المثلثية",
                "النسب المثلثية للزوايا ضمن الدورة الواحدة",
                "تمثيل الاقترانات المثلثية",
                "حل المعادلات المثلثية"
            ]},
            {"unit": "الوحدة الرابعة: تطبيقات المثلثات", "lessons": [
                "الاتجاه من الشمال",
                "قانون الجيوب",
                "قانون جيوب التمام",
                "استعمال جيب الزاوية",
                "حل مسائل ثلاثية الأبعاد"
            ]},
            {"unit": "الوحدة الخامسة: الاقترانات", "lessons": [
                "الاقترانات كثيرات الحدود",
                "اقترانات الجذر التربيعي",
                "الاقترانات النسبية",
                "اقترانات القيمة المطلقة",
                "الاقترانات المتعددة التعريف"
            ]},
            {"unit": "الوحدة السادسة: المشتقات", "lessons": [
                "تقدير ميل المنحني",
                "المتباينات",
                "التقييم المنطقي والتقييم العددي"
            ]},
            {"unit": "الوحدة السابعة: المتجهات", "lessons": [
                "المتجهات في المستوى الاحداثي",
                "جمع المتجهات وطرحها",
                "الضرب القياسي"
            ]},
            {"unit": "الوحدة الثامنة: الإحصاء والاحتمالات", "lessons": [
                "أشكال الانتشار",
                "المنحني التكراري التراكمي",
                "مقاييس التشتت للجدول التكراري ذي الفئات",
                "احتمالات الحوادث المتنافية",
                "احتمالات الحوادث المستقلة والحوادث غير المستقلة"
            ]},
        ],
        "الفيزياء": [
            {"unit": "الوحدة الأولى: المتجهات", "lessons": [
                "الكميات القياسية والكميات المتجهة",
                "المتجهات وطرحها"
            ]},
            {"unit": "الوحدة الثانية: الحركة", "lessons": [
                "الحركة في بعد واحد",
                "الحركة في بعدين"
            ]},
            {"unit": "الوحدة الثالثة: القوة", "lessons": [
                "القانون الأول لنيوتن",
                "القانون الثاني والثالث في الحركة لنيوتن"
            ]},
            {"unit": "الوحدة الرابعة: تطبيقات على قوانين نيوتن", "lessons": [
                "الوزن وقانون الجذب العام",
                "تطبيقات على القوى",
                "القوة المركزية"
            ]},
            {"unit": "الوحدة الخامسة: المواقع", "lessons": [
                "المواقع النسبية",
                "المواقع المتحركة"
            ]},
        ],
        "الكيمياء": [
            {"unit": "الوحدة الأولى: بنية الذرة وتركيبها", "lessons": [
                "نظرية بور لذرة الهيدروجين",
                "النموذج الميكانيكي الموجي"
            ]},
            {"unit": "الوحدة الثانية: التوزيع الإلكتروني والدورية", "lessons": [
                "التوزيع الإلكتروني للذرات",
                "الخصائص الدورية للعناصر"
            ]},
            {"unit": "الوحدة الثالثة: الروابط والتفاعلات الكيميائية", "lessons": [
                "الروابط الكيميائية وأنواعها",
                "الصيغ الكيميائية وخصائص المركبات"
            ]},
            {"unit": "الوحدة الرابعة: التفاعلات والحسابات الكيميائية", "lessons": [
                "التفاعلات الكيميائية",
                "المول والكتلة المولية",
                "الحسابات الكيميائية"
            ]},
            {"unit": "الوحدة الخامسة: الطاقة الكيميائية", "lessons": [
                "التغيرات في الطاقة في التفاعلات الكيميائية",
                "الطاقة الممتصة والطاقة المنبعثة",
                "حسابات الطاقة في التفاعلات الكيميائية"
            ]},
        ],
        "العلوم الحياتية": [
            {"unit": "الوحدة الأولى: نظرية التطور", "lessons": [
                "تطور الكائنات الحية"
            ]},
            {"unit": "الوحدة الثانية: الفيروسات والبريونات والبدائيات", "lessons": [
                "الفيروسات",
                "الفيرويدات والبريونات"
            ]},
            {"unit": "الوحدة الثالثة: تصنيف الكائنات الحية", "lessons": [
                "أسس علم التصنيف",
                "البدائيات",
                "الطلائعيات",
                "الفطريات",
                "النباتات اللاوعائية",
                "النباتات الوعائية البذرية",
                "خصائص الحيوانات وأسس تصنيفها",
                "اللافقاريات",
                "الفقاريات"
            ]},
            {"unit": "الوحدة الرابعة: البيئة", "lessons": [
                "الكائنات الحية في بيئتها",
                "الجماعات الحيوية",
                "تعاقب البيئي"
            ]},
        ],
        "علوم الأرض والبيئة": [
            {"unit": "الوحدة الأولى: الصخور", "lessons": [
                "الصخور النارية",
                "الصخور الرسوبية",
                "الصخور المتحولة"
            ]},
            {"unit": "الوحدة الثانية: النجوم", "lessons": [
                "ماهية النجوم",
                "الأنظمة النجمية والكوكبات",
                "حياة النجوم"
            ]},
            {"unit": "الوحدة الثالثة: الارصاد الجوية", "lessons": [
                "الكتل والجبهات الهوائية",
                "أنظمة الضغط الجوي"
            ]},
            {"unit": "الوحدة الرابعة: المحيطات", "lessons": [
                "خصائص مياه المحيطات",
                "أمواج المحيط",
                "تيارات المحيط والمناخ"
            ]},
            {"unit": "الوحدة الخامسة: المياه العادمة", "lessons": [
                "مفهوم المياه العادمة",
                "الآثار السلبية للمياه العادمة",
                "معالجة المياه العادمة"
            ]},
        ],
        "التاريخ": [
            {"unit": "الوحدة الأولى: الإمبراطورية الفارسية", "lessons": [
                "الإمبراطورية الفارسية: النشأة والتطور",
                "الدولة الساسانية",
                "الحكم والمؤسسات في الدولة الساسانية",
                "الحياة العامة في الدولة الساسانية",
                "علاقات الدولة الساسانية الخارجية",
                "نهاية الدولة الساسانية"
            ]},
            {"unit": "الوحدة الثانية: الدولة العثمانية", "lessons": [
                "الدولة العثمانية",
                "فتح القسطنطينية (إسطنبول)",
                "الحياة العامة في الدولة العثمانية",
                "الوطن العربي في ظل الحكم العثماني",
                "الأردن في ظل الحكم العثماني",
                "نهاية الدولة العثمانية"
            ]},
            {"unit": "الوحدة الثالثة: ثورات غيرت التاريخ", "lessons": [
                "الثورة الصناعية",
                "إنجازات الثورة الصناعية",
                "الثورة الأمريكية",
                "مراحل الثورة الأمريكية",
                "الثورة الفرنسية",
                "نتائج الثورة الفرنسية",
                "الثورة الروسية",
                "العالم في القرن العشرين"
            ]},
            {"unit": "الوحدة الرابعة: شخصيات من التاريخ", "lessons": [
                "محمد علي باشا",
                "المهاتما غاندي",
                "زيغريد هونكه"
            ]},
        ],
        "العربية لغتي": [
            {"unit": "الوحدة الأولى: من أدب الاعتذار", "lessons": [
                "أقرأ بطلاقة وفهم (آيات من الذكر الحكيم)",
                "ابني لغتي: (1) أسلوب الشرط",
                "الأسلوب الخبري: (2)"
            ]},
            {"unit": "الوحدة الثانية: يرحلون ونبقى", "lessons": [
                "أقرأ بطلاقة وفهم (إلى الصمدين غرب النهر)",
                "ابني لغتي: (1) أسلوب النداء",
                "الأسلوب الإنشائي (الإنشاء الطلبي): (2)"
            ]},
            {"unit": "الوحدة الثالثة: مختارات من الأدب المترجم", "lessons": [
                "أقرأ بطلاقة وفهم (اللغة الأم)",
                "ابني لغتي: (1) معاني الأفعال المزيدة",
                "الأسلوب الإنشائي (الإنشاء غير الطلبي): (2)"
            ]},
            {"unit": "الوحدة الرابعة: من السيرة الذاتية", "lessons": [
                "أقرأ بطلاقة وفهم (شغف القراءة وحكايات أخرى)",
                "ابني لغتي: (1) مصادر الأفعال الثلاثية",
                "موسيقى لغتي وإيقاعها: (2)"
            ]},
            {"unit": "الوحدة الخامسة: من الأدب القديم", "lessons": [
                "أقرأ بطلاقة وفهم (بم التعلل لا أهل ولا وطن)",
                "ابني لغتي: (1) مصادر الأفعال غير الثلاثية",
                "موسيقى لغتي وإيقاعها: (2)"
            ]},
        ],
    }

    # إضافة رقم لكل درس داخل كل وحدة
    lessons_with_numbers = []
    for unit in curriculum.get(subject_name, []):
        numbered_lessons = [{"number": idx+1, "title": lesson} for idx, lesson in enumerate(unit["lessons"])]
        lessons_with_numbers.append({"unit": unit["unit"], "lessons": numbered_lessons})

    context = {
        "grade_number": grade_number,
        "subject_name": subject_name,
        "lessons": lessons_with_numbers,
    }

    return render(request, "academics/subject_detail.html", context)



from django.shortcuts import render

def timetable_view(request):
    # جداول الصفوف مع الشعبة
    timetables = {
        "التاسع أ": [
            ["الأحد", ["رياضيات", "حاسوب", "عربي", "دين", "اجتماعيات", "E", "فن", "أحياء"]],
            ["الاثنين", ["فيزياء", "كيمياء", "عربي", "رياضيات", "دين", "اجتماعيات", "رياضيات", "عربي"]],
            ["الثلاثاء", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "أحياء", "فيزياء", "عربي", "E"]],
            ["الأربعاء", ["رياضيات", "عربي", "كيمياء", "اجتماعيات", "رياضيات", "دين", "أحياء", "فيزياء"]],
            ["الخميس", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "أحياء", "فيزياء", "عربي", "دين"]],
        ],
        "التاسع ب": [
            ["الأحد", ["رياضيات", "أحياء", "دين", "E", "فيزياء", "عربي", "حاسوب", "اجتماعيات"]],
            ["الاثنين", ["مالية", "رياضيات", "عربي", "E", "مهني", "فيزياء", "عربي", "اجتماعيات"]],
            ["الثلاثاء", ["رياضيات", "عربي", "أحياء", "دين", "E", "فيزياء", "عربي", "حاسوب"]],
            ["الأربعاء", ["اجتماعيات", "رياضيات", "عربي", "كيمياء", "أحياء", "فيزياء", "عربي", "دين"]],
            ["الخميس", ["رياضيات", "عربي", "أحياء", "دين", "E", "فيزياء", "عربي", "اجتماعيات"]],
        ],
        "التاسع ح": [
            ["الأحد", ["صفة", "رياضيات", "رياضيات", "اجتماعيات", "كيمياء", "دين", "دين", "E"]],
            ["الاثنين", ["دين", "كيمياء", "اجتماعيات", "رياضيات", "رياضيات", "عربي", "E", "E"]],
            ["الثلاثاء", ["E", "حاسوب", "فيزياء", "عربي", "رياضيات", "رياضيات", "دين", "دين"]],
            ["الأربعاء", ["عربي", "عربي", "رياضيات", "رياضيات", "E", "E", "اجتماعيات", "كيمياء"]],
            ["الخميس", ["رياضيات", "رياضيات", "اجتماعيات", "دين", "دين", "عربي", "عربي", "حاسوب"]],
        ],
        "التاسع د": [
            ["الأحد", ["عربي", "رياضيات", "مالية", "اجتماعيات", "كيمياء", "فيزياء", "دين"]],
            ["الاثنين", ["مهني", "رياضيات", "عربي", "اجتماعيات", "كيمياء", "فيزياء", "دين"]],
            ["الثلاثاء", ["رياضيات", "عربي", "اجتماعيات", "علوم", "رياضة", "كيمياء", "دين"]],
            ["الأربعاء", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "فيزياء", "دين", "أرض"]],
            ["الخميس", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "فيزياء", "دين", "علوم"]],
        ],
        "التاسع هـ": [
            ["الأحد", ["رياضيات", "أرض", "حاسوب", "رياضة", "E", "كيمياء"]],
            ["الاثنين", ["اجتماعيات", "عربي", "رياضيات", "فيزياء", "كيمياء", "عربي"]],
            ["الثلاثاء", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "فيزياء", "E"]],
            ["الأربعاء", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "فيزياء", "عربي"]],
            ["الخميس", ["رياضيات", "عربي", "اجتماعيات", "كيمياء", "فيزياء", "مالية"]],
        ],
        "العاشر الأكاديمي": [
            ["الأحد", ["عربي", "رياضيات", "E", "فيزياء", "اجتماعيات", "أحياء", "-", "-"]],
            ["الاثنين", ["رياضيات", "كيمياء", "عربي", "أحياء", "E", "اجتماعيات", "-", "-"]],
            ["الثلاثاء", ["فيزياء", "رياضيات", "كيمياء", "عربي", "E", "أحياء", "اجتماعيات", "-"]],
            ["الأربعاء", ["عربي", "رياضيات", "حاسوب", "كيمياء", "فيزياء", "E", "أحياء", "اجتماعيات"]],
            ["الخميس", ["حاسوب", "رياضيات", "عربي", "E", "فيزياء", "كيمياء", "اجتماعيات", "أحياء"]],
        ],
        "العاشر الأكاديمي ب": [
            ["الأحد", ["دين", "اجتماعيات", "رياضيات", "عربي", "رياضيات", "عربي", "E"]],
            ["الاثنين", ["كيمياء", "E", "حاسوب", "رياضيات", "E", "أحياء", "عربي",]],
            ["الثلاثاء", ["رياضيات", "عربي", "E", "E", "أحياء", "أرض", "عربي", "رياضيات"]],
            ["الأربعاء", ["اجتماعيات", "دين", "رياضيات", "كيمياء", "E", "E", "عربي"]],
            ["الخميس", ["رياضيات", "عربي", "E", "E", "أحياء", "اجتماعيات", "كيمياء", "دين"]],
        ],
        "العاشر الأكاديمي ج": [
            ["الأحد", ["E", "فيزياء", "رياضيات", "عربي", "مالية", "تاريخ", "كيمياء",]],
            ["الاثنين", ["حاسوب", "عربي", "E", "رياضيات", "جغرافيا", "دين", "فن"]],
            ["الثلاثاء", ["E", "كيمياء", "وطنية", "عربي", "دين", "رياضيات"]],
            ["الأربعاء", ["أحياء", "E", "رياضة", "رياضيات", "أرض", "عربي"]],
            ["الخميس", ["رياضيات", "E", "حاسوب", "عربي", "فيزياء", "دين"]],
        ],
        "العاشر الأكاديمي د": [
            ["الأحد", ["أرض", "كيمياء", "دين", "رياضيات", "حاسوب", "اجتماعيات", "فيزياء"]],
            ["الاثنين", ["عربي", "رياضيات", "كيمياء", "دين", "اجتماعيات", "فيزياء", "E"]],
            ["الثلاثاء", ["رياضيات", "عربي", "كيمياء", "اجتماعيات", "دين", "فيزياء", "حاسوب"]],
            ["الأربعاء", ["رياضيات", "عربي", "كيمياء", "اجتماعيات", "دين", "فيزياء", "أرض"]],
            ["الخميس", ["رياضيات", "عربي", "كيمياء", "اجتماعيات", "دين", "فيزياء", "عربي"]],
        ],
        "أول ثانوي الأكاديمي أ": [
            ["الأحد", ["رياضة", "كيمياء", "عربي", "فيزياء", "حاسوب", "رياضيات", "أرض", "انجليزي"]],
            ["الاثنين", ["الأردن", "رياضيات", "عربي", "كيمياء", "فيزياء", "رياضيات", "عربي", "E"]],
            ["الثلاثاء", ["رياضيات", "عربي", "كيمياء", "فيزياء", "رياضيات", "عربي", "أرض", "E"]],
            ["الأربعاء", ["رياضيات", "عربي", "كيمياء", "فيزياء", "رياضيات", "عربي", "حاسوب", "E"]],
            ["الخميس", ["رياضيات", "عربي", "كيمياء", "فيزياء", "رياضيات", "عربي", "أرض", "E"]],
        ],
        "أول ثانوي الأكاديمي هـ": [
            ["الأحد", ["E", "أرض", "الأردن", "حاسوب", "عربي", "رياضيات", "رياضيات"]],
            ["الاثنين", ["رياضيات", "عربي", "الأردن", "حاسوب", "كيمياء", "فيزياء", "فيزياء"]],
            ["الثلاثاء", ["رياضيات", "عربي", "الأردن", "كيمياء", "كيمياء", "E", "E"]],
            ["الأربعاء", ["رياضيات", "عربي", "الأردن", "كيمياء", "رياضيات", "رياضيات", "رياضيات"]],
            ["الخميس", ["رياضيات", "عربي", "الأردن", "كيمياء", "فيزياء", "E", "E"]],
        ],
    }

    # اختيار الصف والشعبة
    selected_class = request.GET.get("class", list(timetables.keys())[0])
    slots = timetables.get(selected_class, [])

    context = {
        "timetables": timetables,
        "selected_class": selected_class,
        "slots": slots,
    }
    return render(request, "academics/timetable.html", context)


# روابط الفيديوهات لكل درس
# روابط الفيديوهات لكل درس
LESSON_VIDEOS = {
    "الدرس الأول: نظام خطية و تربيعية": [
        "https://www.youtube.com/embed/01zNKLvdGsw",
    ],
    "الدرس الثاني: نظام معادلتين تربيعيتين": [
        "https://www.youtube.com/embed/dIX6577H8-M",
        "https://www.youtube.com/embed/_MpRYE7EfHE",
        "https://www.youtube.com/embed/3rgQAiqW934",
    ],
    "الدرس الثالث: تبسيط المقادير الأسية": [
        # ضع رابط صالح هنا إذا كان متاحًا
    ],
    "الدرس الرابع: حل المعادلة الأسية": [
        # ضع رابط صالح هنا إذا كان متاحًا
    ],
}

def lesson_video_view(request, grade_number, subject_name, lesson_number):
    """
    عرض صفحة فيديو الدرس للصف العاشر والرياضيات فقط.
    يحول روابط الفيديوهات تلقائيًا لنمط YouTube nocookie.
    """
    # السماح فقط للصف العاشر والرياضيات
    if subject_name != "الرياضيات" or grade_number != 10:
        raise Http404("هذا الدرس غير متاح")

    # قائمة الدروس بالترتيب
    curriculum_lessons = [
        "الدرس الأول: نظام خطية و تربيعية",
        "الدرس الثاني: نظام معادلتين تربيعيتين",
        "الدرس الثالث: تبسيط المقادير الأسية",
        "الدرس الرابع: حل المعادلة الأسية",
    ]

    # جلب عنوان الدرس
    try:
        lesson_title = curriculum_lessons[lesson_number - 1]
    except IndexError:
        raise Http404("الدرس غير موجود")

    # جلب الفيديوهات وتحويلها لنمط nocookie
    videos = LESSON_VIDEOS.get(lesson_title, [])
    safe_videos = [v.replace("youtube.com/embed", "youtube-nocookie.com/embed") for v in videos if v]

    context = {
        "grade_number": grade_number,
        "subject_name": subject_name,
        "lesson": {
            "title": lesson_title,
            "videos": safe_videos,
        },
    }

    return render(request, "academics/lesson_video.html", context)